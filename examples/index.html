


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>Examples - Pandoc</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4dd2dd8d.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#examples" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Pandoc" class="md-header-nav__button md-logo" aria-label="Pandoc">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Pandoc
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Examples
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/boisgera/pandoc/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pandoc
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Pandoc" class="md-nav__button md-logo" aria-label="Pandoc">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Pandoc
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/boisgera/pandoc/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pandoc
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Examples
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="Examples" class="md-nav__link md-nav__link--active">
      Examples
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#uppercase" class="md-nav__link">
    Uppercase
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#de-emphasize" class="md-nav__link">
    De-emphasize
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comments" class="md-nav__link">
    Comments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#theorems" class="md-nav__link">
    Theorems
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notebooks" class="md-nav__link">
    Notebooks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-web-documents" class="md-nav__link">
    Save Web Documents
  </a>
  
    <nav class="md-nav" aria-label="Save Web Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unpack-divs" class="md-nav__link">
    Unpack Divs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unpack-divs-variant" class="md-nav__link">
    Unpack Divs (Variant)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-the-preamble" class="md-nav__link">
    Remove The Preamble
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../document/" title="Document" class="md-nav__link">
      Document
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../elements/" title="Elements" class="md-nav__link">
      Elements
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../iteration/" title="Iteration" class="md-nav__link">
      Iteration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../configuration/" title="Configuration" class="md-nav__link">
      Configuration
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../api/" title="API Reference" class="md-nav__link">
      API Reference
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#uppercase" class="md-nav__link">
    Uppercase
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#de-emphasize" class="md-nav__link">
    De-emphasize
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comments" class="md-nav__link">
    Comments
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#theorems" class="md-nav__link">
    Theorems
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notebooks" class="md-nav__link">
    Notebooks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#save-web-documents" class="md-nav__link">
    Save Web Documents
  </a>
  
    <nav class="md-nav" aria-label="Save Web Documents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unpack-divs" class="md-nav__link">
    Unpack Divs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unpack-divs-variant" class="md-nav__link">
    Unpack Divs (Variant)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-the-preamble" class="md-nav__link">
    Remove The Preamble
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/boisgera/pandoc/edit/master/mkdocs/examples.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <p><strong>TODO:</strong> plain text (no image, no link, no div, not attribute, etc.). 
Now that attributes &amp; divs are captured from HTML, it can become VERY
noisy, a filter like that could alleviate the problem. Test it on
pandoc's web site for example? This is interesting, we will have
to 'flatten' the divs. At least get rid of everything that smells
too much HTML (link <em>may</em> be ok?), like raw html &amp; divs.
Wait there is no raw html in this case right? Get rid of it anyway.</p>
<h1 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h1>
<pre><code>&gt;&gt;&gt; import pandoc
&gt;&gt;&gt; from pandoc.types import *

&gt;&gt;&gt; def T(function):
...     def _f(markdown):
...         doc = pandoc.read(markdown)
...         _doc = function(doc)
...         if _doc is not None:
...             doc = _doc
...         print(pandoc.write(doc))
...     return _f
</code></pre>
<h2 id="uppercase">Uppercase<a class="headerlink" href="#uppercase" title="Permanent link">&para;</a></h2>
<pre><code>&gt;&gt;&gt; def capitalize(doc):
...     for elt in pandoc.iter(doc):
...         if isinstance(elt, Str):
...             elt[0] = elt[0].upper()


&gt;&gt;&gt; T(capitalize)("I can't feel my legs")
I CAN'T FEEL MY LEGS
&lt;BLANKLINE&gt;
</code></pre>
<p><strong>TODO:</strong> extra NEWLINE in the output, solve this.
OR maybe this is to be expected? A doc DOES END with a newline?
See what pandoc does about this.</p>
<h2 id="de-emphasize">De-emphasize<a class="headerlink" href="#de-emphasize" title="Permanent link">&para;</a></h2>
<p><strong>TODO:</strong> think of the pattern: if something matches a condition, 
          replace it with something (and stop the iteration in this
          branch? Or iterate on the new object?). 
          Pandoc-filters has the ability to let the 
          "atomic transformation" control the rest of the iteration
          by calling walk. See how this is done, study walk.</p>
<pre><code>&gt;&gt;&gt; def capitalize(doc):
...     for elt in pandoc.iter(doc):
...         if isinstance(elt, Str):
...             elt[0] = elt[0].upper()


&gt;&gt;&gt; T(capitalize)("I can't feel my legs")
I CAN'T FEEL MY LEGS
&lt;BLANKLINE&gt;
</code></pre>
<p><strong>TODO:</strong> extra NEWLINE in the output, solve this.
OR maybe this is to be expected? A doc DOES END with a newline?
See what pandoc does about this.</p>
<h2 id="comments">Comments<a class="headerlink" href="#comments" title="Permanent link">&para;</a></h2>
<p>Remove everything between <code>&lt;!-- BEGIN COMMENT --&gt;</code> and <code>&lt;!-- END COMMENT --&gt;</code>.
The comment lines must appear on lines by themselves, 
with blank lines surrounding them.</p>
<p><strong>TODO:</strong> find HTML RawBlocks, check for start/end markers, 
remove the items within.</p>
<p><strong>TODO:</strong> these scheme <em>may</em> fail with tuples right?
          Improve the "Block holder" detection.</p>
<pre><code>&gt;&gt;&gt; def begin_comment(elt):
...     return isinstance(elt, RawBlock) and \
...            elt[0] == Format(u"html") and \
...            "&lt;!-- BEGIN COMMENT --&gt;" in elt[1]
...
&gt;&gt;&gt; def end_comment(elt):
...     return isinstance(elt, RawBlock) and \
...            elt[0] == Format(u"html") and \
...            "&lt;!-- END COMMENT --&gt;" in elt[1]
</code></pre>
<p>And now</p>
<pre><code>&gt;&gt;&gt; def ignore_comments(doc):
...     for elt in pandoc.iter(doc):
...         if isinstance(elt, list) and len(elt) &gt; 0 and isinstance(elt[0], Block):            
...             children = []
...             in_comment = False
...             for child in elt[:]:
...                 if begin_comment(child):
...                     in_comment = True
...                 elif end_comment(child):
...                     in_comment = False
...                 else:
...                     if not in_comment:
...                         children.append(child)
...             elt[:] = children
</code></pre>
<p>Leads to</p>
<pre><code>&gt;&gt;&gt; markdown = """\
... Regular text
...
... &lt;!-- BEGIN COMMENT --&gt;
... A comment
...
... &lt;!-- END COMMENT --&gt;
... Moar regular text
... """
&gt;&gt;&gt; T(ignore_comments)(markdown)
Regular text
&lt;BLANKLINE&gt;
Moar regular text
&lt;BLANKLINE&gt;
</code></pre>
<h2 id="theorems">Theorems<a class="headerlink" href="#theorems" title="Permanent link">&para;</a></h2>
<p>Convert divs with class="theorem" to LaTeX theorem environments in LaTeX output,
and to numbered theorems in HTML output.</p>
<p><strong>TODO:</strong> to HTML version. Also export to LaTeX and HTML to see the outputs?
Can it be done with an option to the <code>T</code> function?</p>
<p><strong>TODO:</strong> think of some support for visitor patterns? 
We see a lot of "do this in-place if this condition is met". 
Or can we use the basic pandoc map/filter? Dunno. Think of it.
Arf with filter or map we have to deal with linearized data types?
We can linearize but can we reassemble. How are filter and map used
for hierarchial structures in functional programming? Have a look at
Haskell (e.g. <a href="https://stackoverflow.com/questions/7624774/haskell-map-for-trees">https://stackoverflow.com/questions/7624774/haskell-map-for-trees</a>).
So, define a <code>pandoc.map</code> helper?</p>
<pre><code>&gt;&gt;&gt; def is_theorem(elt):
...     if isinstance(elt, Div):
...         attrs = elt[0]
...         _, classes, _ = attrs
...         if "theorem" in classes:
...             return True
...     return False

&gt;&gt;&gt; def LaTeX(text):
...     return RawBlock(Format('latex'), text)

&gt;&gt;&gt; def theorem_latex(doc):
...     for elt in pandoc.iter(doc):
...         if is_theorem(elt):
...             id_ = elt[0][0]
...             label = ""
...             if id_:
...                 label = r'\label{' + id_ + '}'
...             start_theorem = LaTeX(r'\begin{theorem}' + label)
...             end_theorem   = LaTeX(r'\end{theorem}')
...             elt[1][:] = [start_theorem] + elt[1] + [end_theorem]

&gt;&gt;&gt; markdown = r"""
... I'd like to introduce the following theorem:
... &lt;div id='cauchy-formula' class='theorem'&gt;
... $$f(z) = \frac{1}{i2\pi} \int \frac{f(w){w-z}\, dw$$
... &lt;/div&gt;
... Right?
... """

&gt;&gt;&gt; T(theorem_latex)(markdown)
I'd like to introduce the following theorem:
&lt;BLANKLINE&gt;
::: {#cauchy-formula .theorem}
```{=latex}
\begin{theorem}\label{cauchy-formula}
```
$$f(z) = \frac{1}{i2\pi} \int \frac{f(w){w-z}\, dw$$
&lt;BLANKLINE&gt;
```{=latex}
\end{theorem}
```
:::
&lt;BLANKLINE&gt;
Right?
&lt;BLANKLINE&gt;
</code></pre>
<h2 id="notebooks">Notebooks<a class="headerlink" href="#notebooks" title="Permanent link">&para;</a></h2>
<p><a href="http://nbformat.readthedocs.io/en/latest/format_description.html#the-notebook-file-format">http://nbformat.readthedocs.io/en/latest/format_description.html#the-notebook-file-format</a></p>
<pre><code>#!/usr/bin/env python

# Python Standard Library
import copy
import json
import os.path
import sys

# Pandoc
import pandoc


def Notebook():
    return copy.deepcopy(
      {
        "cells": [],
        "metadata": {
          "kernelspec": {
            "display_name": "Python 3",
            "language": "python",
            "name": "python3"
          },
          "language_info": {
            "codemirror_mode": {
              "name": "ipython",
              "version": 3
            },
            "file_extension": ".py",
            "mimetype": "text/x-python",
            "name": "python",
            "nbconvert_exporter": "python",
            "pygments_lexer": "ipython3",
            "version": "3.6.4"
           }
        },
        "nbformat": 4,
        "nbformat_minor": 2
      }
    )

def CodeCell():
    return copy.deepcopy(
      {
        "cell_type": "code",
        "execution_count": 1,
        "metadata": {},
        "outputs": [],
        "source": []
      }
    )

def MarkdownCell(): 
    return copy.deepcopy(
      {
        "cell_type": "markdown",
        "metadata": {},
        "source": []
      }
    )

def notebookify(doc):
    from pandoc.types import Pandoc, Meta, CodeBlock
    notebook = Notebook()
    cells = notebook['cells']
    blocks = doc[1]
    #print(blocks)
    execution_count = 1
    for block in blocks:
        if isinstance(block, CodeBlock):
            source = block[1]
            code_cell = CodeCell()
            code_cell['source'] = source
            code_cell['execution_count'] = execution_count
            execution_count += 1
            cells.append(code_cell)
        else:
            wrapper = Pandoc(Meta({}), [block])
            #print(wrapper)
            source = pandoc.write(wrapper)
            markdown_cell = MarkdownCell()
            markdown_cell['source'] = source
            cells.append(markdown_cell)
    return notebook

if __name__ == '__main__':
    filename = sys.argv[1]
    doc = pandoc.read(file=filename)
    notebook = notebookify(doc)
    base, _ = os.path.splitext(filename)
    output = open(base + '.ipynb', 'w')
    output.write(json.dumps(notebook, indent=2))
    output.close()
</code></pre>
<h2 id="save-web-documents">Save Web Documents<a class="headerlink" href="#save-web-documents" title="Permanent link">&para;</a></h2>
<p>When you find an interesting piece of content on the Web,
you may want to archive it on your computer.
Since you are only interested in the content 
and not the full web page, 
there are things in the HTML document 
that you want probably want to remove in the process
(ads, social media, etc.). 
And while you're at it, 
why not store the result as Markdown, 
which is a simpler document description language?
We know that thanks to pandoc, we can convert it 
to something fancy like PDF if the need arises.</p>
<p>Consider for example the <a href="https://pandoc.org/getting-started.html">"Getting started"</a> 
section of the the pandoc documentation. This is a useful document,
I want to keep a copy of it in my hard drive.
Downloading it and converting it to Markdown is easy:</p>
<pre><code>$ curl https://pandoc.org/getting-started.html &gt; getting-started.html
$ pandoc -o getting-started.md getting-started.html
</code></pre>
<p>However, when you look at the result, this is very "noisy".
Its starts with</p>
<pre><code>::: {#doc .container-fluid}
::: {#flattr}
[](https://pandoc.org){.FlattrButton}

[![Flattr
this](https://api.flattr.com/button/flattr-badge-large.png "Flattr this")](https://flattr.com/thing/936364/Pandoc)
:::

::: {#paypal}
![](https://www.paypalobjects.com/en_US/i/scr/pixel.gif){width="1"
height="1"}
:::

[Pandoc]{.big}   [a universal document converter]{.small}

::: {#bd}
::: {.navbar-header}
[Toggle navigation]{.sr-only} []{.icon-bar} []{.icon-bar} []{.icon-bar}
:::

::: {.navbar-collapse .collapse}
-   [About](index.html)
-   [Installing](installing.html)
-   ...
:::

::: {.col-md-9 .col-sm-8 role="main"}
::: {.row}
::: {#toc}
-   [Step 1: Install pandoc](#step-1-install-pandoc)
-   [Step 2: Open a terminal](#step-2-open-a-terminal)
-   ...
:::
</code></pre>
<p>There are two different kind of things here:</p>
<ul>
<li>
<p>a "div soup", characterized by the sheer number of <code>:::</code> symbols<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>.
    In pandoc-flavored Markdown, the <code>:::</code> syntax corresponds to
    the <code>&lt;div&gt;</code> tag in HTML.
    Div hierarchies are often used to style HTML elements, 
    so this is something that we don't need anymore.</p>
</li>
<li>
<p>components that don't make sense out of the web page: 
    some buttons, a navigation bar, etc.</p>
</li>
</ul>
<p>It's only after this long and noisy preamble that you find the real content.
It looks like this:</p>
<pre><code>This document is for people who are unfamiliar with command line tools.
Command-line experts can go straight to the [User's Guide](README.html)
or the pandoc man page.

Step 1: Install pandoc
======================

First, install pandoc, following the [instructions for your
platform](installing.html).

Step 2: Open a terminal
=======================

...
</code></pre>
<p>And finally, you close the four divs in which the content is nested:</p>
<pre><code>:::
:::
:::
:::
</code></pre>
<p>This is probably not the document that you want to store. 
To simplify it, we are going to remove all the hierarchy 
of divs and get rid of the preamble.</p>
<h3 id="unpack-divs">Unpack Divs<a class="headerlink" href="#unpack-divs" title="Permanent link">&para;</a></h3>
<pre><code>def unpack_divs(doc):
    "Unpack Divs - Two-pass, In-Place Algorithm"

    # Locate the divs and extract the relevant data
    matches = []
    for elt, path in pandoc.iter(doc, path=True):
        if isinstance(elt, Div):
            div = elt
            parent, index = path[-1]
            contents = div[1]
            # Blocks are always held in lists (cf. the document model).
            assert isinstance(parent, list)
            matches.append((parent, index, contents))

    # We need to unpack the divs in reverse document order 
    # not to invalidate the remaining matches.
    for parent, index, contents in reversed(matches):
        del parent[index]
        parent[index:index] = contents

    return doc
</code></pre>
<h3 id="unpack-divs-variant">Unpack Divs (Variant)<a class="headerlink" href="#unpack-divs-variant" title="Permanent link">&para;</a></h3>
<p>You may find that the approach above is convoluted. 
It's actually perfectly possible to achieve the same transformation 
in one pass if we build a new document 
instead of modifying the original.</p>
<p>This is best achieved using recursion. To get a feeling how recursion
can be used to create modified copies of a document, we can first 
implement a copy without modification:</p>
<pre><code>def copy(elt):
    "Copy the document (or document fragment) recursively"
    # List, tuple, map and (non-primitive) Pandoc types
    if hasattr(elt, "__iter__") and not isinstance(elt, String):
        type_ = type(elt)
        if type_ is map:
            args = list(elt.items())
        else:
            args = elt[:]
        new_args = [copy(arg) for arg in args]
        if issubclass(type_, (list, tuple, map)):
            return type_(new_args)
        else: # Pandoc types
            return type_(*new_args)
    else: # Python atomic (immutable) types
        return elt
</code></pre>
<p>Note that the name of the function argument is not <code>doc</code> but <code>elt</code> since the 
<code>copy</code> function may be used with any document fragment, not merely with a
document.</p>
<p>Let's go back to our original problem, which is div unpacking. 
Since divs are held in lists of blocks, 
we define a predicate that identifies lists of blocks:</p>
<pre><code>def is_blocks(elt): 
    "Identify (non-empty) lists of blocks"
    return isinstance(elt, list) and \
           len(elt)!=0 and \
           isinstance(elt[0], Block)
</code></pre>
<p>And now we are ready to define the alternate implementation of <code>unpack_div</code>.
First, we detect when <code>elt</code> is a list of blocks and 
in this case, if some of these blocks are divs, 
we expand them:</p>
<pre><code>def unpack_divs(elt):
    "Unpack Divs - One-Pass, Recursive, Non-Destructive Algorithm"

    # Find the list of blocks and their div children and unpack them
    if is_blocks(elt):
        blocks = elt
        new_blocks = []
        for block in blocks:
            if isinstance(block, Div):
                div = block
                contents = div[1]
                new_blocks.extend(unpack_divs(contents))
            else:
                new_blocks.append(unpack_divs(block))
        assert not any([isinstance(block, Div) for block in new_blocks])
        return new_blocks
</code></pre>
<p>We also need to handle the remaining cases, but this is easy
since this is similar to what the recursive <code>copy</code> is doing:</p>
<pre><code>    # List, tuple, map and (non-primitive) Pandoc types
    elif hasattr(elt, "__iter__") and not isinstance(elt, String):
        type_ = type(elt)
        if type_ is map:
            args = list(elt.items())
        else:
            args = elt[:]
        new_args = [unpack_divs(arg) for arg in args]
        if issubclass(type_, (list, tuple, map)):
            return type_(new_args)
        else: # Pandoc types
            return type_(*new_args)
    else: # Python atomic (immutable) types
        return elt
</code></pre>
<h3 id="remove-the-preamble">Remove The Preamble<a class="headerlink" href="#remove-the-preamble" title="Permanent link">&para;</a></h3>
<p>At this stage, if you wrap any of the <code>unpack_divs</code> into</p>
<pre><code># file: simplify.py
if __name__ == "__main__":
    url = 'https://pandoc.org/getting-started.html'
    src = urllib.request.urlopen(url).read()
    doc = pandoc.read(src, format="html")
    doc = unpack_divs(doc)
    print(pandoc.write(doc, format="markdown", options=["-s"]))
</code></pre>
<p>This is what you get when you execute the script:</p>
<pre><code>$ python simplify.py 
---
lang: en
title: 'Pandoc - Getting started with pandoc'
viewport: 'width=device-width, initial-scale=1.0'
---

[](https://pandoc.org){.FlattrButton}

[![Flattr
this](https://api.flattr.com/button/flattr-badge-large.png "Flattr this")](https://flattr.com/thing/936364/Pandoc)

![](https://www.paypalobjects.com/en_US/i/scr/pixel.gif){width="1"
height="1"}

[Pandoc]{.big}   [a universal document converter]{.small}

[Toggle navigation]{.sr-only} []{.icon-bar} []{.icon-bar} []{.icon-bar}

-   [About](index.html)
-   [Installing](installing.html)
-   ...

-   [Step 1: Install pandoc](#step-1-install-pandoc)
-   [Step 2: Open a terminal](#step-2-open-a-terminal)
-   ...

This document is for people who are unfamiliar with command line tools.
Command-line experts can go straight to the [User's Guide](README.html)
or the pandoc man page.

Step 1: Install pandoc
======================

First, install pandoc, following the [instructions for your
platform](installing.html).

Step 2: Open a terminal
=======================

...

If you get stuck, you can always ask questions on the
[pandoc-discuss](http://groups.google.com/group/pandoc-discuss) mailing
list. But be sure to check the [FAQs](faqs.html) first, and search
through the mailing list to see if your question has been answered
before.
</code></pre>
<p>This is better, since there is no more div, but we still need to get rid 
of everything before the first real paragraph, 
the one that starts with some plain text: "This document ...".
So we can detect this first paragraph 
– for example because it starts with an instance of <code>Str</code> – 
and remove everything before it from the document:</p>
<pre><code>def remove_preamble(doc):
    "Remove everything before the first real paragraph"
    blocks = doc[1]
    for i, block in enumerate(blocks):
        if isinstance(block, Para):
            para = block
            inlines = para[0]
            if len(inlines) &gt; 0 and isinstance(inlines[0], Str):
                break
    doc[1] = blocks[i:]
    return doc
</code></pre>
<p>Now, change the main entry point accordingly:</p>
<pre><code># file: simplify.py
if __name__ == "__main__":
    url = 'https://pandoc.org/getting-started.html'
    src = urllib.request.urlopen(url).read()
    doc = pandoc.read(src, format="html")
    doc = unpack_divs(doc)
    doc = remove_preamble(doc)
    print(pandoc.write(doc, format="markdown", options=["-s"]))
</code></pre>
<p>and this is what you get:</p>
<pre><code>$ python simplify.py
---
lang: en
title: 'Pandoc - Getting started with pandoc'
viewport: 'width=device-width, initial-scale=1.0'
---

This document is for people who are unfamiliar with command line tools.
Command-line experts can go straight to the [User's Guide](README.html)
or the pandoc man page.

Step 1: Install pandoc
======================

First, install pandoc, following the [instructions for your
platform](installing.html).

Step 2: Open a terminal
=======================

...

If you get stuck, you can always ask questions on the
[pandoc-discuss](http://groups.google.com/group/pandoc-discuss) mailing
list. But be sure to check the [FAQs](faqs.html) first, and search
through the mailing list to see if your question has been answered
before.
</code></pre>
<p>Mission accomplished!</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>We could also disable the <code>native_divs</code> option in pandoc to get rid 
of the div soup, but where would be the fun then?&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href=".." title="Overview" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </div>
            </div>
          </a>
        
        
          <a href="../document/" title="Document" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Document
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>